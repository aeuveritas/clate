#!/usr/bin/env python3

import argparse
import os
from clate_core import clate_core

CLATE_JSON = os.getenv("HOME") + '/.clate.json'


def parse():
    parser = argparse.ArgumentParser()
    parser.add_argument('-a', '--active', help='active project', default=None)
    parser.add_argument('-g', '--generate', help='generate compile_commands.json', default=None)
    parser.add_argument('-d', '--debug', help='run project with debug mode', action='store_true')

    return parser.parse_args()


def main():
    if not os.path.exists(CLATE_JSON):
        print("[ ERR ] {0} is not existed.".format(CLATE_JSON))
        return

    params = parse()

    cnt = 0

    if params.active:
        cnt += 1
    if params.generate:
        cnt += 1
    if params.debug:
        cnt += 1

    if cnt > 1:
        print("[ ERR ] only 1 option is available.")
        return

    dirMgr = clate_core.DirManager()
    interactor = clate_core.Interactor(dirMgr)
    clate = clate_core.Clate(CLATE_JSON, dirMgr, interactor)

    if params.active:
        clate.run(params.active)
    elif params.generate:
        clate.compile(params.generate)
    elif params.debug:
        clate.run(is_debug=True)
    else:
        clate.console()

    print("[ INF ] clate is closed")


if __name__ == '__main__':
    main()
